<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.booktodolist.todoList.TodoMapper">

    <select id="selUserLevel">
        select book_level
        from b_user
        where iuser = 1;
    </select>

    <select id="selUserCount">
        select book_count
        from b_user
        where iuser = 1;
    </select>

    <select id="selcategorylist">
        SELECT C.cate_name,A.itodo,B.title,A.bookmark, B.totalpage,A.finish_yn finish,A.del_yn del ,A.memo,
        date_format(A.start_date, '%Y-%m-%d') start,date_format(A.finished_date, '%Y-%m-%d') end,C.color,B.isbn
        FROM b_list A
        INNER JOIN book B
        on A.ibook = B.ibook
        INNER JOIN icategory C
        ON B.icate = C.icate
        ORDER BY C.cate_name,A.itodo
    </select>

    <select id="selDetail">
        SELECT date_format(A.created_todo_date, '%Y-%m-%d') createdTodo , C.cate_name catename ,B.title,B.writer,
        date_format(A.start_date, '%Y-%m-%d') start,date_format(A.finished_date, '%Y-%m-%d')end,A.memo,A.finish_yn finish,B.publisher
        FROM b_list A
        INNER JOIN book B
        ON A.ibook = B.ibook
        INNER JOIN icategory C
        ON B.icate = C.icate
        WHERE itodo = #{itodo}
    </select>

    <update id="UpdTodo">
        UPDATE b_list
        SET start_date = #{start},
        finished_date = #{end},
        finish_yn = #{finish},
        memo = #{memo}
        WHERE itodo = #{itodo}
    </update>

    <select id = "selTodo">
        select start_date start, finished_date end, memo, finish_yn finish
        from b_list
        where itodo = #{itodo}
    </select>

    <update id="UpdCount">
        UPDATE b_user
        SET book_count = book_count + #{num}
        WHERE iuser = 1;
    </update>

    <update id="UpdLevel">
        UPDATE b_user
        SET book_level = book_level+1,
        book_count = 0
        WHERE iuser = 1 and
        book_count >= 50;
    </update>

    <update id = "DelTodo">
        update b_list
        set del_yn = 1
        where itodo = #{itodo}
    </update>

</mapper>